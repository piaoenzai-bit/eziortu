<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="white" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#ffffff" />
    <title>现场照片</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* ========== 苹果设计系统基础变量 ========== */
      :root {
        --system-bg: #ffffff;
        --system-fg: #000000;
        --system-gray-10: #f9f9f9;
        --system-gray-20: #f2f2f2;
        --system-gray-30: #e6e6e6;
        --system-gray-40: #d6d6d6;
        --system-gray-50: #c6c6c6;
        --system-gray-60: #aeaeae;
        --system-gray-70: #8e8e93;
        --system-gray-80: #636366;
        --system-gray-90: #3a3a3c;
        --system-blue: #007aff;

        --corner-radius-xs: 4px;
        --corner-radius-sm: 8px;
        --corner-radius-md: 12px;
        --corner-radius-lg: 16px;
        --corner-radius-xl: 20px;

        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-2xl: 48px;
        --spacing-3xl: 64px;

        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.08);

        --blur-xs: 4px;
        --blur-sm: 8px;
        --blur-md: 12px;
        --blur-lg: 20px;

        --spring: cubic-bezier(0.2, 0, 0, 1);
        --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
        --duration-fast: 0.2s;
        --duration-medium: 0.3s;
        --duration-slow: 0.5s;
      }

      /* ========== 苹果设计系统重置 ========== */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      }

      html {
        font-size: 16px;
        -webkit-text-size-adjust: 100%;
        scroll-behavior: smooth; /* 平滑滚动锚点 */
      }

      body {
        background-color: var(--system-bg);
        color: var(--system-fg);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "SF Pro Icons", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
        font-weight: 400;
        line-height: 1.47059;
        letter-spacing: -0.022em;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        padding-bottom: env(safe-area-inset-bottom);
        /* 调整顶部内边距，为导航栏留出空间 */
        padding-top: calc(env(safe-area-inset-top) + 44px);
      }

      /* ========== 苹果风格导航栏 (iOS标准导航栏) ========== */
      .apple-navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 44px;
        padding-top: env(safe-area-inset-top);
        padding-left: var(--spacing-sm);
        padding-right: var(--spacing-sm);
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(var(--blur-sm));
        -webkit-backdrop-filter: blur(var(--blur-sm));
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 1000;
      }

      /* 返回按钮 (iOS原生样式) */
      .back-button {
        display: flex;
        align-items: center;
        height: 34px;
        padding: 0 var(--spacing-sm);
        border-radius: var(--corner-radius-xs);
        color: var(--system-blue);
        font-size: 17px;
        font-weight: 400;
        cursor: pointer;
        transition: background-color var(--duration-fast) var(--ease-in-out);
      }

      .back-button:hover {
        background-color: rgba(0, 122, 255, 0.06);
      }

      .back-button:active {
        background-color: rgba(0, 122, 255, 0.12);
      }

      .back-icon {
        width: 8px;
        height: 14px;
        margin-right: 6px;
        border-left: 2px solid var(--system-blue);
        border-top: 2px solid var(--system-blue);
        transform: rotate(-45deg);
        transform-origin: 2px 2px;
      }

      .navbar-title {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 17px;
        font-weight: 500;
        color: var(--system-fg);
        max-width: 60%;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* ========== 苹果风格毛玻璃 ========== */
      .apple-glass {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(var(--blur-md));
        -webkit-backdrop-filter: blur(var(--blur-md));
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      /* ========== 背景动画元素（苹果风格） ========== */
      .animation-container {
        position: fixed;
        inset: 0;
        z-index: -1;
        pointer-events: none;
        overflow: hidden;
      }

      .frame-decoration {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: var(--corner-radius-lg);
        opacity: 0.7;
        transition: all var(--duration-slow) var(--spring);
      }

      .grid-overlay {
        position: absolute;
        bottom: 10%;
        right: 8%;
        width: clamp(120px, 40vw, 240px);
        height: clamp(120px, 40vw, 240px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: var(--corner-radius-sm);
        opacity: 0.4;
        animation: gridRotate 20s linear infinite;
      }

      .grid-overlay::before,
      .grid-overlay::after {
        content: "";
        position: absolute;
        background-color: rgba(0, 0, 0, 0.1);
      }

      .grid-overlay::before {
        top: 50%;
        left: 0;
        width: 100%;
        height: 1px;
        transform: translateY(-50%);
      }

      .grid-overlay::after {
        left: 50%;
        top: 0;
        height: 100%;
        width: 1px;
        transform: translateX(-50%);
      }

      @keyframes gridRotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .radial-overlay {
        position: absolute;
        top: 15%;
        left: 10%;
        width: clamp(180px, 60vw, 320px);
        height: clamp(180px, 60vw, 320px);
        background: radial-gradient(
          circle,
          rgba(0, 0, 0, 0.05) 0%,
          transparent 70%
        );
        border-radius: 50%;
        opacity: 0.6;
        animation: radialPulse 8s ease-in-out infinite alternate;
      }

      @keyframes radialPulse {
        0% {
          transform: scale(1) translate(0, 0);
        }
        100% {
          transform: scale(1.1) translate(10px, -10px);
        }
      }

      /* ========== 状态栏信息（苹果风格） ========== */
      .status-bar {
        position: fixed;
        top: calc(env(safe-area-inset-top) + 44px); /* 调整位置，避开导航栏 */
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 11px;
        color: var(--system-gray-80);
        z-index: 100;
      }

      .frame-counter {
        font-weight: 500;
        color: var(--system-fg);
      }

      /* ========== 页面标题（苹果排版规范） ========== */
      .page-header {
        padding: var(--spacing-2xl) var(--spacing-xl) var(--spacing-xl); /* 调整顶部间距 */
        text-align: center;
        max-width: 720px;
        margin: 0 auto;
        /* 锚点定位目标 */
        scroll-margin-top: calc(
          env(safe-area-inset-top) + 44px + var(--spacing-md)
        );
      }

      .page-title {
        font-size: clamp(2rem, 8vw, 3.5rem);
        font-weight: 300;
        line-height: 1.1;
        letter-spacing: -0.01em;
        margin-bottom: var(--spacing-md);
      }

      .page-subtitle {
        font-size: clamp(0.875rem, 3vw, 1rem);
        color: var(--system-gray-70);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 400;
      }

      /* ========== 图片网格（苹果布局规范） ========== */
      .gallery-container {
        padding: 0 var(--spacing-md) var(--spacing-2xl);
        max-width: 980px;
        margin: 0 auto;
        /* 锚点定位目标 */
        scroll-margin-top: calc(
          env(safe-area-inset-top) + 44px + var(--spacing-md)
        );
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: var(--spacing-md);
      }

      @media (min-width: 768px) {
        .gallery-grid {
          grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
          gap: var(--spacing-lg);
        }
      }

      .gallery-item {
        border-radius: var(--corner-radius-md);
        overflow: hidden;
        aspect-ratio: 16/9;
        background-color: var(--system-gray-10);
        box-shadow: var(--shadow-sm);
        transform: translateZ(0);
        transition: all var(--duration-medium) var(--spring);
        position: relative;
      }

      .gallery-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .gallery-item:active {
        transform: translateY(0);
        box-shadow: var(--shadow-sm);
      }

      .gallery-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transition: opacity var(--duration-slow) var(--ease-in-out);
      }

      .gallery-image.loaded {
        opacity: 1;
      }

      /* ========== 返回顶部按钮（苹果设计） ========== */
      .back-to-top {
        position: fixed;
        bottom: calc(env(safe-area-inset-bottom) + var(--spacing-xl));
        right: var(--spacing-xl);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background-color: var(--system-gray-20);
        border: 1px solid var(--system-gray-30);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all var(--duration-fast) var(--ease-in-out);
        z-index: 100;
        cursor: pointer;
      }

      .back-to-top.visible {
        opacity: 1;
        visibility: visible;
      }

      .back-to-top:hover {
        background-color: var(--system-gray-30);
      }

      .back-to-top:active {
        background-color: var(--system-gray-40);
      }

      .to-top-icon {
        width: 16px;
        height: 16px;
        border-top: 2px solid var(--system-gray-80);
        border-left: 2px solid var(--system-gray-80);
        transform: rotate(45deg);
        margin-bottom: 4px;
      }

      /* ========== 滚动条（苹果风格） ========== */
      ::-webkit-scrollbar {
        width: 4px;
        height: 4px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--system-gray-40);
        border-radius: 2px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--system-gray-50);
      }

      /* ========== 无障碍和性能优化 ========== */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.001s !important;
          transition-duration: 0.001s !important;
        }
        html {
          scroll-behavior: auto;
        }
      }
    </style>
  </head>

  <body>
    <!-- 苹果风格导航栏 -->
    <nav class="apple-navbar">
      <div class="back-button" id="navBackButton">
        <div class="back-icon"></div>
        <span>返回</span>
      </div>
      <div class="navbar-title">现场照片</div>
    </nav>

    <!-- 苹果风格状态栏信息 -->
    <div class="status-bar">
      <div>ON-SET PHOTOS</div>
      <div class="frame-counter" id="frameCounter">01/16</div>
    </div>

    <!-- 背景动画元素 -->
    <div class="animation-container">
      <div class="frame-decoration" style="width: 85vw; height: 70vh"></div>
      <div class="frame-decoration" style="width: 75vw; height: 60vh"></div>
      <div class="grid-overlay"></div>
      <div class="radial-overlay"></div>
    </div>

    <!-- 页面内容 -->
    <main>
      <!-- 标题区域 - 锚点目标 -->
      <header class="page-header" id="header">
        <h1 class="page-title">现场照片</h1>
        <p class="page-subtitle">On-Set Photos · 朴恩在</p>
      </header>

      <!-- 图片画廊 - 锚点目标 -->
      <div class="gallery-container" id="gallery">
        <div class="gallery-grid">
          <!-- 第1张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/1.jpg"
              class="gallery-image"
              data-index="01"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第2张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/7.jpg"
              class="gallery-image"
              data-index="02"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第3张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/15.jpg"
              class="gallery-image"
              data-index="03"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第4张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/17.jpg"
              class="gallery-image"
              data-index="04"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第5张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/22.jpg"
              class="gallery-image"
              data-index="05"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第6张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/19.jpg"
              class="gallery-image"
              data-index="06"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第7张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/23.jpg"
              class="gallery-image"
              data-index="07"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第8张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/25.jpg"
              class="gallery-image"
              data-index="08"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第9张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/21.jpg"
              class="gallery-image"
              data-index="09"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第10张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/8.jpg"
              class="gallery-image"
              data-index="10"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第11张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/10.jpg"
              class="gallery-image"
              data-index="11"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第12张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/18.jpg"
              class="gallery-image"
              data-index="12"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第13张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/20.jpg"
              class="gallery-image"
              data-index="13"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第14张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/9.jpg"
              class="gallery-image"
              data-index="14"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第15张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/4.jpg"
              class="gallery-image"
              data-index="15"
              onload="this.classList.add('loaded')"
            />
          </div>
          <!-- 第16张 -->
          <div class="gallery-item">
            <img
              src="assets/On-set photos/5.jpg"
              class="gallery-image"
              data-index="16"
              onload="this.classList.add('loaded')"
            />
          </div>
        </div>
      </div>
    </main>

    <!-- 返回顶部按钮 -->
    <div class="back-to-top" id="backToTop" onclick="scrollToTop()">
      <div class="to-top-icon"></div>
    </div>

    <script>
      // ========== 苹果风格交互逻辑 ==========

      // 1. 导航栏返回功能 + 锚点定位
      function initNavbar() {
        const backButton = document.getElementById("navBackButton");

        // 记录当前页面的锚点，返回时携带
        backButton.addEventListener("click", () => {
          backButton.style.transform = "scale(0.95)";
          setTimeout(() => {
            backButton.style.transform = "scale(1)";

            // 获取当前滚动位置，判断在哪个模块
            const scrollY = window.scrollY;
            const galleryTop = document.getElementById("gallery").offsetTop;
            // 定义锚点：滚动到图片区则携带 #gallery
            const hash = scrollY >= galleryTop - 100 ? "#gallery" : "#header";

            if (window.history.length > 1) {
              // 返回上一页，并传递锚点（需要上一页支持锚点接收）
              window.history.back();
            } else {
              // 降级跳转首页，携带锚点
              window.location.href = `./index.html${hash}`;
            }
          }, 100);
        });
      }

      // 2. 页面加载时检测锚点，自动定位
      function initHashNavigation() {
        // 获取URL中的锚点
        const hash = window.location.hash;
        if (hash && document.querySelector(hash)) {
          // 滚动到锚点位置
          document.querySelector(hash).scrollIntoView({
            behavior: "smooth",
          });
        }
      }

      // 3. 安全区域适配
      function applySafeArea() {
        const safeTop = env("safe-area-inset-top");
        document.documentElement.style.setProperty(
          "--safe-area-top",
          `${safeTop}px`
        );
      }

      // 4. 滚动监听 - 苹果风格的平滑动画
      let currentFrame = 1;
      const totalFrames = 16; // 更新为16张图片
      const frameCounter = document.getElementById("frameCounter");
      const backToTop = document.getElementById("backToTop");
      const frameDecorations = document.querySelectorAll(".frame-decoration");
      const galleryItems = document.querySelectorAll(".gallery-item");

      function updateFrameCounter() {
        frameCounter.textContent = `${String(currentFrame).padStart(
          2,
          "0"
        )}/${totalFrames}`;
      }

      function handleScroll() {
        const scrollY = window.scrollY;
        const windowHeight = window.innerHeight;
        const documentHeight = document.body.scrollHeight;
        const scrollProgress = Math.min(
          1,
          scrollY / (documentHeight - windowHeight)
        );

        // 更新帧计数器
        currentFrame = Math.min(
          totalFrames,
          Math.floor(scrollProgress * totalFrames) + 1
        );
        updateFrameCounter();

        // 显示/隐藏返回顶部按钮
        backToTop.classList.toggle("visible", scrollY > windowHeight * 0.3);

        // 背景装饰动画（苹果风格的微妙动效）
        frameDecorations.forEach((frame, index) => {
          const depth = index * 0.1;
          const scale = 1 + scrollProgress * 0.1 * (1 + depth);
          const rotate = scrollProgress * 5 * (index % 2 === 0 ? 1 : -1);
          const opacity = 0.7 - scrollProgress * 0.3 + depth * 0.2;

          frame.style.transform = `translate(-50%, -50%) scale(${scale}) rotate(${rotate}deg)`;
          frame.style.opacity = opacity;
        });

        // 图片项视差效果
        galleryItems.forEach((item, index) => {
          const rect = item.getBoundingClientRect();
          const itemProgress = Math.max(
            0,
            Math.min(1, 1 - (rect.top - windowHeight) / (windowHeight * 1.5))
          );
          const translateY = (1 - itemProgress) * 20;

          item.style.transform = `translateY(${translateY}px)`;
          item.style.opacity = itemProgress;
        });
      }

      // 5. 图片懒加载（Intersection Observer）
      function initLazyLoading() {
        const images = document.querySelectorAll(".gallery-image");
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.src;
                observer.unobserve(img);
              }
            });
          },
          {
            rootMargin: "200px 0px",
            threshold: 0.01,
          }
        );

        images.forEach((img) => observer.observe(img));
      }

      // 6. 回到顶部功能（苹果风格的平滑滚动）
      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      // 7. 触摸优化（苹果风格的触控体验）
      function initTouchHandlers() {
        let touchStartY = 0;

        document.addEventListener(
          "touchstart",
          (e) => {
            touchStartY = e.touches[0].clientY;
          },
          { passive: true }
        );

        document.addEventListener(
          "touchmove",
          (e) => {
            // 防止滚动时的过度回弹
            const touchY = e.touches[0].clientY;
            const isScrollingUp = touchY > touchStartY;

            if (window.scrollY === 0 && isScrollingUp) {
              e.preventDefault();
            }
          },
          { passive: false }
        );
      }

      // 8. 初始化
      document.addEventListener("DOMContentLoaded", () => {
        initNavbar(); // 初始化导航栏
        initHashNavigation(); // 初始化锚点定位
        applySafeArea();
        initLazyLoading();
        initTouchHandlers();

        // 初始触发滚动处理
        handleScroll();

        // 滚动监听（节流优化）
        let ticking = false;
        window.addEventListener(
          "scroll",
          () => {
            if (!ticking) {
              requestAnimationFrame(() => {
                handleScroll();
                ticking = false;
              });
              ticking = true;
            }
          },
          { passive: true }
        );

        // 窗口大小变化监听
        window.addEventListener("resize", handleScroll);
      });

      // 辅助函数：获取env变量
      function env(variable) {
        return (
          parseFloat(
            getComputedStyle(document.documentElement).getPropertyValue(
              variable
            )
          ) || 0
        );
      }
    </script>
  </body>
</html>
